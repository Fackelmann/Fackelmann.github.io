<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Daniel G. Plaza - Page 2</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
    <link rel="preload" href="/fonts/et-bembo-roman-line-figures/et-bembo-roman-line-figures.woff" as="font" type="font/woff" crossorigin>
    <link rel="canonical" href="/">
    <meta property="og:url" content="/">
    <link rel="author" href="/about/">
    <meta name="author" content="Daniel Gonzalez Plaza" />
    <meta name="title" content="Home | Daniel G. Plaza" />
    <meta name="description" content="Website of Daniel G. Plaza" />
    <meta property="og:description" content="Website of Daniel G. Plaza">
    <meta property="og:site_name" content="Daniel G. Plaza">
    <meta property="og:title" content="Home | Daniel G. Plaza">
    <meta property="og:image" content="/images/eric_head.jpg">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:creator" content="">
    <meta name="twitter:site" content=""></head>
<body>
    <aside id="asidebar">
<!---        <div id="logo">
            <a href="/"><img src="/" alt="Lawler.io logo" /></a>
        </div> --->
        <nav class="main-menu">
<ul>
    <li><a href="/">Home</a></li>
    <li><a href="/scrivings/">Vault</a></li>
</ul>        </nav>

<ul id="social">
    <li><a href="https://github.com/Fackelmann" title="GitHub" target=_blank rel="noopener"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wMQBSkoPIUbOQAAAWNJREFUOMuVk7FKQzEUhr970UmXDklG26UKFfUFFCm+gopTJx0UHOpWfAAdHBx00CfQDvoAHUR0FRSk6NI6JpkEnapel3NLCLXUA4F7kv//85+TcxMkjNJY7zBKV4A9YBmYkuM34AY4st4951iAJCJfAGsMj0vr3XrOSQLyC1BmtHi13k0bpUmF3BTyE1ADugJ8l4Xs1QRTNko3cwdzwKOAzq13W8OuNkqfAZuSzqdAPTgfG8F+iKknRulu0O1J4DPv8IDbASaAj/x1EqP0j7zGl/VufJQOGqV74iRLgewf9uMyshToBMpVsflnCUbparDVSYFW4OIaKEaEUKMIXAV5KzFKF8XFPlABNoAHYNd6dy9CS8AxsBCZKuWjfAJsA7PyH5SAFeA7qLkXkU+tdzvhKN8CM8Aq4Kx37aj+LEjvrHeL/fLyD6P0gVE6i8B9AVmHISceEozSBaN0Y4BAwyhdiMm/6K92B5mUXmkAAAAASUVORK5CYII=" alt="GitHub"></a></li>
    <li><a href="https://www.linkedin.com/in/daniel-gonzalez-plaza/" title="LinkedIn" target=_blank rel="noopener"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wMSEiICt6p2WgAAARdJREFUOMudU0GKg0AQrJ7VQ25pCQSEfCDfyKs2ePC0z/EHOUZy8g85iXgwigddxNrTDGui7JqCgammp6Z7ukZU9RPAF97DWVSVlokISK5SMHaTZRnyPEeSJOsFRARhGML3fRyPx1VVGAAgiTRNUZYlLpcLROQlkeSssHsDY4xLIAljjNsDQBzH8DwPURRNhVSV2+2Wj8eD4zjydrtN+P1+5zAMHMfRrd1uR1WlqtLMlfobh8PBVWNxvV5fp7CEqqoQBAGCIEBRFACA/X7vLvpTwB4SEeR5vuyDJdR17abS9/16gX878V14tr+2bQEAXde9cIuu69A0Ddq2dW1NPhPJiQuf+VzsY7PZfAM42UomNp2x9FPs/AN6xJlXb4YRtgAAAABJRU5ErkJggg==" alt="LinkedIn"></a></li>
</ul>    </aside>
    <main>            <article>
                <header>
                    <h1>
                        <a href="/scrivings/on-shuffling-and-permutations/" rel="bookmark"  title="Permanent link to &quot;On shuffling and permutations&quot;">On shuffling and permutations</a>                    </h1>

                    <p><span class="newthought">Daniel Gonzalez Plaza</span></p>
                    <p><span class="newthought">August 25, 2019</span></p>
                        <p><span class="newthought">Filed under &ldquo;<a href="/categories/cs/" rel="tag">CS</a>&rdquo;</span></p>
                </header>

                <section>
<h2>How would you shuffle a deck of cards?</h2>
<p>A couple of weeks ago I was talking to a friend about the problem of shuffling a deck of cards. His take on it was to do:</p>
<h3>Shuffle 1</h3>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">n</span> <span class="n">do</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span> <span class="n">do</span> <span class="n">swap</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">Random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="p">]]</span>
</pre></div>


<p>My idea was:</p>
<h3>Shuffle 2</h3>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">n</span> <span class="n">do</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span> <span class="n">to</span> <span class="mi">1</span> <span class="n">do</span> <span class="n">swap</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">random</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]]</span>
</pre></div>


<p>Both of them seemed reasonable, but were any of them correct?</p>
<p>And what does it mean for the shuffling implementation to be correct? It means that each of the possible permutations of the array (or deck) is equally likely. Which is equivalent to the problem of generating a random permutation of a given array.</p>
<p>This week I was flipping through Skiena&rsquo;s &ldquo;The algorithm design manual&rdquo; and landed in section 14.4 &ldquo;Generating permutations&rdquo;, and ended up spending my weekend researching this subject.</p>
<h2>Permutations</h2>
<p>As mentioned previously the problem of shuffling a deck of cards (or an array of distinct elements for that matter) is equivalent to generating a random permutation. A standard playing card deck has 52 cards, and hence 52! possible deck arrangements. After shuffling we want to make sure every one of those possible 52! outputs is equally likely.</p>
<h2>How to do this?</h2>
<p>For small arrays it is feasible (but not trivial) to generate all possible permutations and then randomly select one of them and return it as the output. The problem is that permutations order of growth is factorial:</p>
<ul>
<li>For 4 cards we have 4! = 24 possible outputs</li>
<li>For 6 cards we have 6! = 720 possible outputs</li>
<li>For 8 cards we have 8! = 40320 possible outputs</li>
<li>&hellip;</li>
<li>For 52 cards we have 52! = ~8.06e67 possible outputs</li>
</ul>
<p>So this approach becomes unreasonable very quickly (factorially so!). There must be a better way.</p>
<h2>On rank</h2>
<p>A quick side-note, as I will be using this in my analysis. The rank of a particular permutation is its position in a given <em>lexicographic</em> generation order. The lexicographic order is the sequence in which the different permutations would appear if they were sorted numerically [1].</p>
<p>It&rsquo;s easier to understand with an example. Let&rsquo;s say we have 3 elements: {1,2,3}. The lexicographic order for its permutations is:</p>
<p>{1,2,3} -&gt; {1,3,2} -&gt; {2,1,3} -&gt; {2,3,1} -&gt; {3,1,2} -&gt; {3,2,1}</p>
<p>So:</p>
<ul>
<li>{1,2,3} will have rank 1</li>
<li>{2,3,1} will have rank 4</li>
<li>and so on</li>
</ul>
<p>In my experiments I will be calculating the rank of every permutation generated. A good shuffling algorithm will generate permutations whose rank is given by a uniform distribution, this is, every rank is equally likely.</p>
<p>Skiena provides a recursive implementation for rank calculation in [1], but I ended up using the simpler implementation explained in [2]</p>
<h2>Shuffling in memory</h2>
<p>A better way to do this is to do something similar to what we do in &ldquo;Shuffle 1&rdquo; and &ldquo;Shuffle 2&rdquo;, this is, randomly swap element of the array. As I said those 2 algorithms seem reasonable, so let me throw another one into the mix:</p>
<h3>Shuffle 3</h3>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">n</span> <span class="n">do</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span> <span class="n">do</span> <span class="n">swap</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">Random</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">]]</span>
</pre></div>


<p>Reasonable enough as well, right? So let&rsquo;s put these 3 algorithms to test. </p>
<p>For every shuffling algorithm I will have an unordered deck of cards ({1,2,3,4}) that I will shuffle and store the rank. I will do this 100k times and I will keep track of how many times each rank has appeared for every algorithm.</p>
<p>If the algorithms provide real random permutations we would expect to see each rank to be equally likely.</p>
<h2>Results</h2>
<p>(Click to enlarge)
<a href="/scrivings/on-shuffling-and-permutations/shuffling.png"><img alt="shuffling" src="/scrivings/on-shuffling-and-permutations/shuffling.png"></a></p>
<p>We observe that both Shuffle 1 and Shuffle 2 provide a uniform distribution of every possible permutation. But Shuffle 3 is definitely favoring some permutations over others. What is happening here?</p>
<h2>Analysis</h2>
<p>Let&rsquo;s put all 3 together here for easier reference.</p>
<h3>Shuffle 1</h3>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">n</span> <span class="n">do</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span> <span class="n">do</span> <span class="n">swap</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">Random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="p">]]</span>
</pre></div>


<h3>Shuffle 2</h3>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">n</span> <span class="n">do</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span> <span class="n">to</span> <span class="mi">1</span> <span class="n">do</span> <span class="n">swap</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">random</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]]</span>
</pre></div>


<h3>Shuffle 3</h3>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">n</span> <span class="n">do</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span> <span class="n">do</span> <span class="n">swap</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">Random</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">]]</span>
</pre></div>


<p>As we can see the variations are minimal.</p>
<p>In <em>Shuffle 1</em> we traverse through the array. At every point we find a random index between the current index and the end of the array, and swap the current element with the element in the random index.</p>
<p>In <em>Shuffle 2</em> we traverse through the array in reversed order. At every point we find a random index between the beginning of the array and the current index, and swap the current element with the element in the random index.</p>
<p>We can already see these 2 implementations are equivalent.</p>
<p>In <em>Shuffle 3</em> we swap the current element with a random element selected from the <em>whole</em> array. Strangely, this solution seems more random since each element can be swapped multiple times. But we already see that it won&rsquo;t provide a truly random permutation. Why? And why do <em>Shuffle 1</em> and <em>Shuffle 2</em> work?</p>
<p>Jeff Atwood explains it beautifully in his article &ldquo;The danger of naivete&rdquo; [3].</p>
<p>Let&rsquo;s say we have a 3 card deck. Shuffle 3 will do 3 shuffles: rand(3), rand(3), and rand(3). For a total of 3^3=27 possible outputs. Strange, since in 3 cards we only have 3! = 6 possible permutations. On the other hand shuffles 1 and 2 will do 2 shuffles: rand(3) and rand(2), for a total of 3*2 = 6 possible outputs. So far what we would expect!</p>
<p>Let&rsquo;s see what the outputs for Shuffling 3 are:</p>
<p>(Click to enlarge)
<a href="/scrivings/on-shuffling-and-permutations/shuffling_tree.png"><img alt="shuffling tree" src="/scrivings/on-shuffling-and-permutations/shuffling_tree.png"></a></p>
<p>If we count each occurrence we have:
<a href="/scrivings/on-shuffling-and-permutations/permutation_count.png"><img alt="permutation count" src="/scrivings/on-shuffling-and-permutations/permutation_count.png"></a></p>
<p>So we see clearly that with &ldquo;Shuffle 3&rdquo; each possible output won&rsquo;t be equally likely. Therefore, this is not a suitable algorithm to shuffle or generate random permutations.</p>
<h2>Fisher-Yates/Knuth Shuffle</h2>
<p>&ldquo;Shuffle 2&rdquo; and &ldquo;Shuffle 3&rdquo; are an implementation of what is known as Fisher-Yates[4] or Knuth (Algorithm P)[5] Shuffle.</p>
<p>Originally developed as a manual method in the 30&rsquo;s by Fisher and Yates, with time complexity O(n^2). The above implementations reduce it&rsquo;s complexity to O(n), by swapping the selected elements and reducing the random index range at every iteration.</p>
<p>Doing a similar analysis as the one showed above would yield the following possible outputs, each one with a count of 1:</p>
<p>{1,2,3},{1,3,2},{2,1,3},{2,3,1},{3,1,2},{3,2,1}</p>
<p>Which is exactly what we want from a random shuffle.</p>
<h2>Takeaway</h2>
<p>We have seen that minimal changes in the implementation of an algorithm can yield results with undesirable random properties. The difference is subtle, easy to miss, and it&rsquo;s not evident which implementations are correct and which are not. It&rsquo;s better to stick with standard libraries when dealing with problems that require truly random results.</p>
<h2>References</h2>
<p>[1] Steven S. Skiena. 2008. The Algorithm Design Manual (2nd ed.). Springer Publishing Company, Incorporated.</p>
<p>[2] <a href="https://stackoverflow.com/questions/39839119/rank-of-a-permutation">https://stackoverflow.com/questions/39839119/rank-of-a-permutation</a></p>
<p>[3] <a href="https://blog.codinghorror.com/the-danger-of-naivete/">https://blog.codinghorror.com/the-danger-of-naivete/</a></p>
<p>[4] <a href="https://en.wikipedia.org/wiki/Fisher–Yates_shuffle">https://en.wikipedia.org/wiki/Fisher–Yates_shuffle</a></p>
<p>[5] Donald E. Knuth. 1997. The Art of Computer Programming, Volume 2 (3rd Ed.): Seminumerical Algorithms. Addison-Wesley Longman Publishing Co., Inc., Boston, MA, USA.</p>
</section>


                <footer class="de-emphasize">
                    <p>Finalized at 6:30 PM.
                    <p>Tagged with
                    <a href="/tags/algorithms-shuffling-permutations/" class="tags">Algorithms Shuffling Permutations</a>.                </footer>
            </article><hr class="separator">            <article>
                <header>
                    <h1>
                        <a href="/scrivings/mantel-clock/" rel="bookmark"  title="Permanent link to &quot;Mantel clock&quot;">Mantel clock</a>                    </h1>

                    <p><span class="newthought">Daniel Gonzalez Plaza</span></p>
                    <p><span class="newthought">July 14, 2019</span></p>
                        <p><span class="newthought">Filed under &ldquo;<a href="/categories/me/" rel="tag">Me</a>&rdquo;</span></p>
                </header>

                <section>
<p>I&rsquo;ve been attending the woodworking classes at Palo Alto High School for the last couple of years. This was my last project for the 2019 Spring term.</p>
<p>It&rsquo;s a craftsman style mantel clock (~15&rsquo; tall). I used white oak and sligthly stained it at the end, along with applying a coat of wax. For the clock face I chosed Cedar.</p>
<p>It was a very technical but rewarding project. All the parts had to be carefully milled and measured to make sure they fit perfectly with each other. The picture doesn&rsquo;t show it, but the top is beveled. It took me a couple of pieces of wood to get that right!</p>
<p><img alt="energy" src="/scrivings/mantel-clock/mantel_clock.jpg"></p>
</section>


                <footer class="de-emphasize">
                    <p>Finalized at 3:30 PM.
                    <p>Tagged with
                    <a href="/tags/woodworking/" class="tags">Woodworking</a>.                </footer>
            </article><hr class="separator extra">            <article>
                <header>
                    <h1>
                        <a href="/scrivings/hello-world/" rel="bookmark"  title="Permanent link to &quot;Hello, World&quot;">Hello, World</a>                    </h1>

                    <p><span class="newthought">Daniel Gonzalez Plaza</span></p>
                    <p><span class="newthought">July 05, 2019</span></p>
                        <p><span class="newthought">Filed under &ldquo;<a href="/categories/me/" rel="tag">Me</a>&rdquo;</span></p>
                </header>

                <section>
<p>My name is Daniel Gonzalez Plaza. I have masters in Electrical (CALTECH) and Telecommunication engineering (Universidad de Cantabria). I live in the Silicon Valley.</p>
<p>I enjoy reading non-fiction (reading list to come), woodworking, and hiking and birding. </p>
<p>You can reach me at dan@danielgplaza.com</p>
</section>


                <footer class="de-emphasize">
                    <p>Finalized at 6:15 PM.
                    <p>Tagged with
                    <a href="/tags/meta/" class="tags">meta</a>.                </footer>
            </article>

    <article>
        <footer class="paginator">                


   <a href="/">&larr;&nbsp;Press into the future</a>

                <span>Page 2 of 2</span>            <span class="hide">Retreat into the past&nbsp;&rarr;</span>        </footer>
    </article>

        <footer>
<p class="de-emphasize copyright">&copy;2019&ndash;2020 Daniel G. Plaza. All rights reserved.        </footer>
    </main>
</body>
</html>